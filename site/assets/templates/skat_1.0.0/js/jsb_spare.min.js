$(function(){var a=$("#table-jcb tbody tr"),m=$("#spare-jcb--count"),u=0;list={},$list=$([]),modal=null,parseForm=function(t){var a=$(t),r=$("ol.sparejcb_skat--list",t),e=$("#table-jcb tbody tr.select"),s=[];return $("li",r).unbind("click"),r.empty(),$.each(e,function(t,a){var e=$(a),l=e.data();r.append($("<li></li>",{class:"zakaz--list--item"}).append($('<span class="zakaz--list--item--title"></span>').text(l.full),$('<span class="zakaz--list--item--remove psicon-x-circle"></span>')).data({target:e})),s.push({article:l.article,name:l.name,proizvod:l.proizvod,full:l.full})}),$("textarea#sparejcb_all",t).text(JSON.stringify(s)),u=$("#table-jcb tbody tr.select").length,m.attr({"data-count":u}).data({count:u}),e.length?$("li",r).on("click",".zakaz--list--item--remove",listItemEvent):(a.unbind("submit"),$.arcticmodal("close"),modal=null),!1},listItemEvent=function(t){t.preventDefault();var a=$(this).closest("form"),e=$(t.delegateTarget),l=$("ol.sparejcb_skat--list",a),r=e.data(),s=$(r.target),n=$(".btn-plus",s),c=$(".btn-minus",s);return $("li",l).unbind("click"),s.removeClass("select"),n.removeAttr("disabled"),c.attr({disabled:"disabled"}),parseForm(a),!1},submitForm=function(t){t.preventDefault();var l=$("#table-jcb tbody tr.select"),r=this,a=$(r),e=$("ol.sparejcb_skat--list",r);if(!l.length)return a.unbind("submit"),$("li",e).unbind("click"),e.empty(),$.arcticmodal("close"),modal=null,!1;var s=new FormData(r);return $.ajax({url:window.location.origin+window.location.pathname,data:s,processData:!1,contentType:!1,type:"POST",dataType:"JSON",success:function(t){var a=$(t.forms.spare);$(r).unbind("submit",submitForm),$(".form_replacer",modal).empty().append(a.clone()),$("#sparejcb_skat").empty().append(a.clone());var e=$("form",modal);if(e.length)return e.bind("submit",submitForm),$("input[name=phone]",e).mask("+7(999)999-99-99"),parseForm(e),!1;$.each(l,function(t,a){var e=$(a),l=$(".btn-minus",a),r=$(".btn-plus",a);e.removeClass("select").data({select:!1}),r.removeAttr("disabled"),l.attr({disabled:"disabled"})}),$(".spare-jcb").addClass("reaply"),u=$("#table-jcb tbody tr.select").length,m.attr({"data-count":u}).data({count:u})},error:function(t,a,e){console.log(t,a,e)}}),!1},m.attr({"data-count":u}).data({count:u}),$.each(a,function(t,a){var e=$("td",a),l=$(a),r=$.trim($(e[0]).text().replace(/&shy;|&#8203;|\xad|\u200B/gm,"").replace(/\s+/gm," ")),s=$.trim($(e[1]).text().replace(/&shy;|&#8203;|\xad|\u200B/gm,"").replace(/\s+/gm," ")),n=$.trim($(e[2]).text().replace(/&shy;|&#8203;|\xad|\u200B/gm,"").replace(/\s+/gm," ")),c=r+" "+s,o=c.toLowerCase(),i={id:t+1+"_jcb__"+r,article:r,name:s,proizvod:n,full:c+" "+n,search:o,select:!1};u=parseInt(m.data().count);var d=$.extend({},i,{target:l});$("button.btn-minus",e[2]).data({target:l}),$("button.btn-plus",e[2]).data({target:l}),$(a).data(d),$(e[1]).text(s+" ("+n+")"),m.attr({"data-count":u}).data({count:u})}),$("#search-jcb").keyup(function(){var t=$.trim($(this).val().toLowerCase().replace(/\s+/gm," "));$.each(a,function(){-1===$(this).data().search.indexOf(t)?$(this).hide():$(this).show()})}),a.on("click","button",function(t){t.preventDefault();var a=$(this).data("target"),e=a.data(),l=$(".btn-plus",a),r=$(".btn-minus",a);return 0==e.select?(a.addClass("select").data({select:!0}),r.removeAttr("disabled"),l.attr({disabled:"disabled"})):(a.removeClass("select").data({select:!1}),l.removeAttr("disabled"),r.attr({disabled:"disabled"})),u=$("#table-jcb tbody tr.select").length,m.attr({"data-count":u}).data({count:u}),!1}),m.on("click",function(t){if(t.preventDefault(),$("#table-jcb tbody tr.select").length){var a=$("#sparejcb_skat").html(),e=$('<div class="box-modal form-modal"><div class="form_replacer"></div></div>');$(".form_replacer",e).append(a);e.prepend('<div class="box-modal_close arcticmodal-close"></div>'),modal=$.arcticmodal({content:e}),f=$("form",modal),f.on("submit",submitForm),parseForm(f)}return!1})});